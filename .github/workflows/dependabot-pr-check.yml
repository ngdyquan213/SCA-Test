name: Dependabot PR Check

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

permissions:
  contents: read
  pull-requests: write
  security-events: write

concurrency:
  group: dependabot-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  dependabot-only:
    # Ch·ªâ ch·∫°y cho PR do Dependabot m·ªü
    if: github.actor == 'dependabot[bot]'
    runs-on: ubuntu-latest

    steps:
      # üîê Checkout pin theo SHA c·ªßa PR (kh√¥ng theo t√™n nh√°nh)
      - name: Checkout (pin by PR SHA)
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}
          fetch-depth: 0

    #   # (Tu·ª≥ ch·ªçn) Thi·∫øt l·∫≠p Python n·∫øu repo c·ªßa b·∫°n l√† Python
    #   - name: Setup Python
    #     uses: actions/setup-python@v5
    #     with:
    #       python-version: '3.11'

      # C√†i dependency n·∫øu c√≥ requirements.txt
    #   - name: Install deps
    #     if: hashFiles('requirements.txt') != ''
    #     run: |
    #       python -m pip install --upgrade pip
    #       pip install -r requirements.txt

    #   # (Tu·ª≥ ch·ªçn) Ch·∫°y test n·∫øu c√≥ th∆∞ m·ª•c tests/ ho·∫∑c file test_*.py
    #   - name: Run pytest (if present)
    #     if: |
    #       hashFiles('**/tests/**') != '' || hashFiles('**/test_*.py') != ''
    #     run: |
    #       pip install pytest
    #       pytest -q

    #   # (Tu·ª≥ ch·ªçn) Qu√©t l·ªó h·ªïng nhanh cho source b·∫±ng Trivy (FS)
    #   - name: Trivy FS scan (optional)
    #     uses: aquasecurity/trivy-action@0.28.0
    #     with:
    #       scan-type: 'fs'
    #       scan-ref: '.'
    #       format: 'sarif'
    #       output: 'trivy.sarif'
    #       ignore-unfixed: true
    #       hide-progress: true
    #   - name: Upload SARIF
    #     if: always()
    #     uses: github/codeql-action/upload-sarif@v3
    #     with:
    #       sarif_file: trivy.sarif

    #   # (Tu·ª≥ ch·ªçn) B·∫≠t auto-merge cho PR b·∫£o m·∫≠t khi CI xanh
    #   - name: Enable auto-merge for security updates
    #     if: always()
    #     uses: dependabot/fetch-metadata@v2
    #     id: meta
    #     with:
    #       github-token: ${{ secrets.GITHUB_TOKEN }}

    #   - name: Auto-merge (security only)
    #     if: steps.meta.outputs.update-type == 'security'
    #     uses: peter-evans/enable-pull-request-automerge@v3
    #     with:
    #       merge-method: squash
